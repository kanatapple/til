# バージョニングとエイリアス

バージョニングを使用するとLambda関数の複数バージョンを発行することができる  
各Lambda関数のバージョンには、一意のAmazonリソースネーム(ARN)がある  
バージョンの発行後は変更不可

Lambdaは各Lambda関数バージョンごとのエイリアスをサポート  
概念的にはエイリアスは特定のLambda関数バージョンに対するポインタだが、Lambda関数に似たリソースでもあり、一意のARNがある  
各エイリアスはそれぞれが指す関数バージョンのARNを保持する(エイリアスが指せるのは別のエイリアスではなく関数バージョンのみ)  
バージョンは変更不可だが、エイリアスは変更可能で異なるバージョンを指すことが可能

例えば、Lambda関数のイベントソースがS3だった場合、S3のバケット通知設定に関数バージョンではなくエイリアスを設定しておいて  
Lambda関数のエイリアスが指すバージョンを変更するだけで、S3の通知設定を変更する必要がない

## バージョニング

Lambda関数を作成した時、バージョンは$LATESTの1つだけ

この初期バージョンに関連付けられるARNは2つ

- 修飾ARN - バージョンのサフィックスが付いた関数ARN
```
arn:aws:lambda:aws-region:acct-id:function:helloworld:$LATEST
```

- 非修飾ARN - バージョンのサフィックスが付いてない関数ARN  
このARNは関連する全てのオペレーションで使用できるが、これを使用してエイリアスを作成することはできない
```
arn:aws:lambda:aws-region:acct-id:function:helloworld
```

`複数バージョンを発行しない限り、$LATESTバージョンが唯一のLambda関数のバージョン`  
`この$LATESTバージョンを呼び出すには、修飾ARNと非修飾ARNのいずれもイベントソースマッピングで使用できる`

## バージョンの発行

バージョンを発行すると$LATESTバージョンにLambda関数コード(および設定)のスナップショットのコピーを作成する  
発行済みバージョンは変更できないので、バージョン発行の前にコーディングと設定を済ませておく

バージョン発行方法

- 明示的にバージョンを発行  
PublishVersion APIを使用して明示的にバージョンを発行  
$LATESTバージョンのコードと設定を使用して新しいバージョンを作成する

- Lambda関数の作成/発行時にバージョンを発行  
CreateFunction、UpdateFunctionCode APIを使用して、リクエストにオプションのpublishパラメータを追加する

`Lambdaは$LATESTバージョンと比較して、コードが発行されていないかコードが変更されてる場合のみ、新しいバージョンを発行する`

Lambda関数の各バージョンはARNを持つ一意のリソース  
以下はhelloworld Lambda関数のバージョン番号1のARN
```
arn:aws:lambda:aws-region:acct-id:function:helloworld:1
```

`発行済バージョンは修飾ARNのみを持つ`

AWS Lambdaは一定間隔で増加するシーケンス番号をバージョニングに割り当て、バージョン番号を再利用することはない

## Lambda関数および特定のバージョンの削除

- 特定のバージョンを削除する - DeleteFunction APIで削除するバージョンを指定して削除できる  
バージョンに依存するエイリアスがある場合はリクエストに失敗する
- Lambda関数全体(バージョン、エイリアス)を削除する - DeleteFunction APIでバージョンを指定しない

`$LATESTバージョンだけは削除できない`